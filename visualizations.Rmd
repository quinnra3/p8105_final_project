---
title: "Visualizations"
output: html_document
date: '2023-12-01'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(knitr)
library(readr)
library(readxl)
library(tidyverse)
library(tidyr)
library(dplyr)
library(stringr)
library(scales)
library(lubridate)
library(plotly)

knitr::opts_chunk$set(
  fig.width = 6,
  out.width = "90%",
  fig.align = "center",
  cache = FALSE
)

theme_set(theme_bw() + 
            theme(plot.title = element_text(hjust = 0.5), 
                  legend.position = "bottom"))

options(scipen = 999)
```

# Loading Data Sets
```{r}
dsny_df <- read_csv("data/DSNY_Monthly_Tonnage_Data_20231108.csv") 

dsny_df = 
  dsny_df |> 
  janitor::clean_names() |> 
  separate(month, c("year", "month"), sep = " / ") |> 
  filter(year == "2023") |> 
  select(-communitydistrict, -resorganicstons, -schoolorganictons, -leavesorganictons, -xmastreetons)


rodent_inspec_df <- read_csv("data/Rodent Inspection Data - 2023.csv")

rodent_inspec_df = 
  rodent_inspec_df |> 
  janitor::clean_names() |> 
  select(-job_id, -job_ticket_or_work_order_id, -job_progress, -bbl, -house_number, -street_name, -block, -lot, -approved_date, -location, -community_board, -council_district, -census_tract, -bin, -nta)

rodent_tidy = 
  rodent_inspec_df |>
  mutate(inspection_date = parse_date_time(inspection_date, orders = "mdy HM"),
         day = day(inspection_date), 
         month = sprintf("%02d", month(inspection_date)), 
         year = year(inspection_date),  
         hour = hour(inspection_date),  
         minute = minute(inspection_date)) |> 
  select(-day, -hour, -minute, -boro_code)
  

total_rat_df = merge(dsny_df, rodent_inspec_df)

rat_merge_df = merge(dsny_df, rodent_tidy)
```


## Table 1
```{r}
## bar graph 

rat_table = 
  total_rat_df |> 
  data.frame(
    borough = c("Manhattan", "Brooklyn", "Bronx", "Queens", "Staten Island"),
    result = c("Passed", "Rat Activity", "Stoppage done", "Bait applied", "Cleanup done", "Failed for Other R", "Monitoring visit")
  ) 

rat_activity_counts <- total_rat_df |> 
  filter(result == "Rat Activity") |> 
  group_by(borough) |> 
  summarise(count = n())  
view(rat_activity_counts)

rat_frequency_plot =
  ggplot(rat_activity_counts, aes(x = borough, y = count)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Frequency of Rat Activity by Borough",
       x = "Borough",
       y = "Frequency") + 
  scale_y_continuous(labels = scales::comma_format(scale = 1e+0))

ggplotly(rat_frequency_plot)
```

This graph illustrates the frequency of rat activity in each borough of New York City. Brooklyn has the most rat activity, with over 300,000 confirmed rat activity sightings. Staten Island has the least amount of rat activity, with only 990 confirmed rat activity sightings. Overall, this graph gives us an idea of how severe the rat problem is in each borough of the city. 

## Table 2

```{r}
rat_activity_counts =
  rat_merge_df |> 
  filter(result == "Rat Activity") |> 
  group_by(month) |> 
  summarise(count = n()) 

view(rat_activity_counts)

rat_month_plot = 
  ggplot(rat_activity_counts, aes(x = month, y = count)) +
  geom_bar(stat = "identity", fill = "violet") +
  labs(title = "Frequency of Rat Activity by Month",
       x = "Month",
       y = "Frequency") + 
  scale_y_continuous(labels = scales::comma_format(scale = 1e+0)) 

ggplotly(rat_month_plot)
```

This graph illustrates the frequency of rat activity across New York City by month in 2023, up to October. The rat frequency stays relatively consistent between January and June, but rises significantly from July to October. This could be because the environment in New York from July to October is the most favorable for rat survival. 

## Table 3

```{r}
seasonal_rat = 
  ggplot(rat_activity_counts, aes(x = month, y = count)) + 
  geom_point() +
  labs(title = "Seasonal Trends in Rat Sightings",
       x = "Month",
       y = "Frequency")

ggplotly(seasonal_rat)
```

This graph illustrates the seasonal trends in rat sightings in New York City. Supported by the graph above, rat sightings are significantly lower in January to June compared to July to October. This suggests that rats are more active in the warmer months compared to the colder months. 

## Table 4

```{r}
rat_activity_counts =
  rat_merge_df |> 
  filter(result == "Rat Activity") |> 
  group_by(month, refusetonscollected) |> 
  summarise(count = n()) 

rat_trash_plot = 
  ggplot(rat_activity_counts, aes(x = month, y = refusetonscollected, color = count)) +
  geom_boxplot(color="red",fill="orange") +
  labs(title = "Relationship Between Trash Tonnage and Rat Sightings by Month",
       x = "Month",
       y = "Trash Collected (by Tonnnage)") 

ggplotly(rat_trash_plot)
```

This graph illustrates a proposed relationship between trash tonnage and rat sightings. Our group hypothesized that where there is more trash collected, there will be a higher rat presence. Based on the distribution of the plot, it appears that there is not a relationship between these two variables; meaning that trash tonnage does not impact rat frequency. 


## Transit App Graphs 

```{r}
app_data <- read_csv("data/Transit app rat reports - 2023-10-08 to 2023-11-07.csv")

rat_app_one_plot = 
  ggplot(app_data, aes(x = station_id, y = one_or_two, color = borough)) + 
  geom_point() +
  geom_smooth(se = FALSE) + 
  facet_grid(. ~ borough) + 
  theme(axis.text.x = element_text(angle = 65, hjust = 3))

ggplotly(rat_app_one_plot)
```

```{r}
rat_app_many_plot = 
  ggplot(app_data, aes(x = station_id, y = so_many, color = borough)) + 
  geom_point() + 
  geom_smooth(se = FALSE) + 
  facet_grid(. ~ borough) + 
  theme(axis.text.x = element_text(angle = 65, hjust = 3)) 

ggplotly(rat_app_many_plot)
```

These graphs illustrate how many rat sightings were recorded in various subway stations in each borough. In this case, Manhattan has the most rat sightings compared to the other boroughs and Staten Island has the least. The first graph shows if one or two rats were spotted and the second shows if "so many" (more than one or two) rats were spotted. 
